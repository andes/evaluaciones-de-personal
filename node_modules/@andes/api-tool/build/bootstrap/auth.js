"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const passportJWT = require("passport-jwt");
const jwt = require("jsonwebtoken");
function initialize(passport, app, jwtKey) {
    passport.use(new passportJWT.Strategy({
        secretOrKey: jwtKey,
        jwtFromRequest: passportJWT.ExtractJwt.fromExtractors([
            passportJWT.ExtractJwt.fromAuthHeaderWithScheme('jwt'),
            passportJWT.ExtractJwt.fromUrlQueryParameter('token')
        ])
    }, (jwt_payload, done) => {
        done(null, jwt_payload);
    }));
    // Inicializa passport
    app.use(passport.initialize());
    return passport;
}
exports.initialize = initialize;
function getToken(req) {
    if (req.headers && req.headers.authorization) {
        return req.headers.authorization.substring(4);
    }
    else if (req.query.token) {
        return req.query.token;
    }
    return null;
}
exports.optionalAuth = (jwtKey) => {
    return (req, res, next) => {
        try {
            const token = getToken(req);
            if (token) {
                const tokenData = jwt.verify(token, jwtKey);
                if (tokenData) {
                    req.user = tokenData;
                }
            }
            next();
        }
        catch (e) {
            next();
        }
    };
};
//# sourceMappingURL=auth.js.map